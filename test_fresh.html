<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Fresh Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .error { color: red; padding: 10px; background: #fee; margin: 5px 0; border-left: 4px solid red; }
        .success { color: green; padding: 10px; background: #efe; margin: 5px 0; border-left: 4px solid green; }
        .info { color: blue; padding: 10px; background: #eef; margin: 5px 0; border-left: 4px solid blue; }
    </style>
</head>
<body>
    <h1>Fresh V2 Test (No Cache)</h1>
    <div id="output">
        <div class="success">✅ HTML loaded</div>
    </div>
    
    <script>
        const log = (msg, type = 'info') => {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = msg;
            document.getElementById('output').appendChild(div);
        };
        
        window.onerror = (msg, src, line, col, err) => {
            log(`ERROR: ${msg} at ${src}:${line}:${col}`, 'error');
            if (err) log(`Stack: ${err.stack}`, 'error');
            return true;
        };
        
        log('✅ JavaScript works', 'success');
        
        // Force no-cache import with timestamp
        const timestamp = Date.now();
        log(`Loading V2 with timestamp: ${timestamp}`, 'info');
        
        import(`/static/js/v2/main.js?t=${timestamp}`)
            .then(() => {
                log('✅ V2 main.js loaded!', 'success');
                
                setTimeout(() => {
                    log('Checking window objects...', 'info');
                    
                    if (window.calculatorManager) {
                        log(`✅ calculatorManager: ${window.calculatorManager.getCalculatorCount()} calculators`, 'success');
                    } else {
                        log('❌ calculatorManager missing', 'error');
                    }
                    
                    if (window.eventBus) {
                        log('✅ eventBus exists', 'success');
                    } else {
                        log('❌ eventBus missing', 'error');
                    }
                    
                    if (window.initializeV2Integration) {
                        log('✅ initializeV2Integration exists', 'success');
                    } else {
                        log('❌ initializeV2Integration missing', 'error');
                    }
                }, 1000);
            })
            .catch(err => {
                log('❌ Failed to load V2 main.js', 'error');
                log(`Error: ${err.message}`, 'error');
                if (err.stack) log(`Stack: ${err.stack}`, 'error');
            });
    </script>
</body>
</html>
