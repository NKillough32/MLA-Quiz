<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MLA Quiz</title>
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MLA Quiz">
    <meta name="theme-color" content="#007AFF">
    
    <!-- iOS Icons - Using custom icon.png -->
    <link rel="apple-touch-icon" href="/static/icons/icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/icons/icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/static/icons/icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- iOS-Style CSS -->
    <style>
        /* Base sizing */
        *,
        *::before,
        *::after { 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body { 
            height: 100%; 
        }
        
        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            line-height: 1.5;
            color: #111827;
            background: #f5f7fb;
            -webkit-font-smoothing: antialiased;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* iOS-Style Navigation */
        .navbar {
            background: #f8f8f8;
            border-bottom: 0.5px solid #c6c6c8;
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .navbar h1 {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
            color: #1c1c1e;
        }
        
        .navbar .back-btn {
            position: absolute;
            left: 16px;
            background: none;
            border: none;
            color: #007AFF;
            font-size: 17px;
            cursor: pointer;
            padding: 0;
        }
        
        .navbar .next-btn {
            position: absolute;
            right: 16px;
            background: none;
            border: none;
            color: #007AFF;
            font-size: 17px;
            cursor: pointer;
            padding: 0;
        }
        
        /* Content Container - legacy styles, minimal impact */
        .container {
            min-height: 100vh;
            margin-top: 56px;
            padding-top: 8px;
        }
        
        /* Page grid layout */
        .quiz-page {
            --sidebar-w: 280px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 16px;
            display: grid;
            grid-template-columns: minmax(600px, 2fr) var(--sidebar-w);
            gap: 32px;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .quiz-page {
                grid-template-columns: 1fr;
                max-width: 900px;
            }
        }

        @media (max-width: 768px) {
            .quiz-page {
                padding: 16px 12px;
            }
        }

        /* Cards */
        .card {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(17,24,39,.06);
            border: 1px solid rgba(17,24,39,.06);
            overflow: hidden;
        }

        .card-body { 
            padding: 8px 20px 12px 20px; 
        }

        @media (max-width: 768px) {
            .card-body {
                padding: 6px 16px 10px 16px;
            }
        }

        /* Sticky sidebar on large screens */
        .sidebar {
            position: sticky;
            top: 80px;
        }

        /* Gradient header bar */
        .q-header {
            padding: 8px 20px 4px 20px;
            color: #fff;
            background: linear-gradient(90deg,#2563eb,#7c3aed);
        }
        .q-header h2, .q-header h3, .q-header p { 
            margin: 0;
            line-height: 1.2;
        }

        /* Image support */
        .q-text img, .investigations img, .new-option img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .image-container {
            text-align: center;
            margin: 10px 0;
            position: relative;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .image-container:hover img {
            transform: scale(1.02);
        }
        
        .image-caption {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 4px;
            font-style: italic;
        }
        
        .image-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f0f8ff;
            border: 1px solid #007AFF;
            border-radius: 6px;
            color: #007AFF;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 4px 0;
            transition: all 0.2s;
        }
        
        .image-link:hover {
            background: #007AFF;
            color: white;
        }
        
        /* Image Modal */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .image-zoom-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none; /* Prevents default browser zoom/scroll */
        }
        
        .image-modal img,
        .zoomable-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            cursor: grab;
            transition: transform 0.2s ease;
        }
        
        .zoomable-image:active {
            cursor: grabbing;
        }
        
        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            z-index: 2001;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-modal-close:hover {
            opacity: 0.7;
        }
        
        /* Dark Mode Styles */
        :root {
            --bg-primary: #f5f7fb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8f8f8;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e5ea;
            --card-bg: #ffffff;
            --button-bg: #007AFF;
            --danger-bg: #ff3b30;
            --success-bg: #34c759;
            --haptic-flash: 0;
        }
        
        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #98989d;
            --border-color: #38383a;
            --card-bg: #1c1c1e;
            --button-bg: #0a84ff;
            --danger-bg: #ff453a;
            --success-bg: #32d74b;
        }

        [data-theme="dark"] body {
            background-color: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .container {
            background-color: var(--bg-primary) !important;
        }
        
        [data-theme="dark"] .main-grid {
            background-color: var(--bg-primary) !important;
        }

        [data-theme="dark"] .quiz-item {
            background-color: var(--card-bg) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .quiz-details {
            color: var(--text-secondary) !important;
        }

        [data-theme="dark"] .sidebar {
            background-color: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
        }
        
        [data-theme="dark"] .progress-stats {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
        }
        
        [data-theme="dark"] .progress-item {
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .new-option {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .new-option.selected {
            background-color: var(--button-bg) !important;
            border-color: var(--button-bg) !important;
            color: white !important;
        }

        [data-theme="dark"] .new-option.ruled-out {
            background-color: var(--bg-secondary) !important;
            opacity: 0.5;
        }

        [data-theme="dark"] .btn {
            background-color: var(--button-bg) !important;
            color: white !important;
        }

        [data-theme="dark"] .explanation-container {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .explanation-container a,
        [data-theme="dark"] .explanation-content a,
        [data-theme="dark"] .explanation-link {
            color: #63b3ed !important;
        }
        
        [data-theme="dark"] .feedback-container {
            background-color: var(--bg-tertiary) !important;
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .navbar {
            background-color: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
        }
        
        [data-theme="dark"] .navbar h1 {
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] input[type="file"] {
            background-color: var(--bg-tertiary) !important;
            color: var(--text-primary) !important;
            border-color: var(--border-color) !important;
        }
        
        [data-theme="dark"] .q-text,
        [data-theme="dark"] .investigations,
        [data-theme="dark"] .prompt {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .investigations h4 {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .investigations {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .investigations div {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .investigations p {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .card {
            background-color: var(--card-bg) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .card-title {
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .card-subtitle {
            color: var(--text-secondary) !important;
        }
        
        /* Dark mode for general heading elements */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6 {
            color: var(--text-primary) !important;
        }
        
        /* Dark mode for general text elements */
        [data-theme="dark"] p {
            color: var(--text-primary) !important;
        }
        
        /* Dark mode for progress buttons and sidebar elements */
        [data-theme="dark"] .progress-stats .progress-item {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        
        [data-theme="dark"] .progress-item {
            background-color: var(--bg-tertiary) !important;
            background: var(--bg-tertiary) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        [data-theme="dark"] .question-list-container {
            background-color: var(--bg-secondary) !important;
        }
        
        [data-theme="dark"] .question-list-container .progress-item {
            background-color: var(--bg-tertiary) !important;
            background: var(--bg-tertiary) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        [data-theme="dark"] .question-list-container .progress-item.current {
            background-color: var(--button-bg) !important;
            background: var(--button-bg) !important;
            color: white !important;
        }
        
        [data-theme="dark"] #time-display {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-secondary) !important;
        }
        
        /* Font size button active state */
        .font-size-btn.active {
            background-color: #007AFF !important;
            color: white !important;
        }
        
        /* Time display styling */
        .time-stats {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 11px;
            color: #8e8e93;
            text-align: center;
        }
        
        [data-theme="dark"] .time-stats {
            color: var(--text-secondary);
        }
        
        /* Floating PDF Export Button */
        .floating-pdf-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #34c759;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 120px;
            justify-content: center;
        }
        
        .floating-pdf-btn:hover {
            background: #30b754;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 199, 89, 0.5);
        }
        
        .floating-pdf-btn:active {
            transform: translateY(0px);
        }
        
        [data-theme="dark"] .floating-pdf-btn {
            background: #32d74b;
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.4);
        }
        
        [data-theme="dark"] .floating-pdf-btn:hover {
            background: #28cd41;
            box-shadow: 0 6px 16px rgba(50, 215, 75, 0.5);
        }
        
        /* Hide on very small screens to avoid interference */
        @media (max-width: 480px) {
            .floating-pdf-btn {
                bottom: 15px;
                right: 15px;
                padding: 10px 14px;
                font-size: 12px;
                min-width: 100px;
            }
        }
        
        /* Hide when on quiz selection screen */
        #quizSelection:not([style*="none"]) ~ .floating-pdf-btn {
            display: none;
        }
        
        /* Medical Tools Toggle Button */
        .medical-tools-toggle {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
            transition: all 0.3s ease;
        }
        
        .medical-tools-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 122, 255, 0.5);
        }
        
        [data-theme="dark"] .medical-tools-toggle {
            background: var(--button-bg);
        }
        
        /* Medical Tools Panel */
        .medical-tools-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            border-left: 1px solid #e5e5ea;
            z-index: 1002;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .medical-tools-panel.open {
            right: 0;
        }
        
        [data-theme="dark"] .medical-tools-panel {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }
        
        /* Tools Header */
        .tools-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5ea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }
        
        .tools-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        .tools-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #8e8e93;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            transition: all 0.2s;
        }
        
        .tools-close-btn:hover {
            background: #e5e5ea;
            color: #1c1c1e;
        }
        
        [data-theme="dark"] .tools-header {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .tools-header h3 {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .tools-close-btn {
            color: var(--text-secondary);
        }
        
        /* Tools Navigation */
        .tools-navigation {
            display: flex;
            border-bottom: 1px solid #e5e5ea;
            background: #f8f9fa;
            overflow-x: auto;
        }
        
        .tool-nav-btn {
            flex: 1;
            min-width: fit-content;
            padding: 12px 16px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #8e8e93;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .tool-nav-btn:hover {
            color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
        }
        
        .tool-nav-btn.active {
            color: #007AFF;
            border-bottom-color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
        }
        
        [data-theme="dark"] .tools-navigation {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .tool-nav-btn {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .tool-nav-btn:hover,
        [data-theme="dark"] .tool-nav-btn.active {
            color: var(--button-bg);
            background: rgba(10, 132, 255, 0.1);
        }
        
        /* Tools Content */
        .tools-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .tool-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
            overflow-y: auto;
            padding: 16px;
            display: none;
        }
        
        .tool-panel.active {
            opacity: 1;
            transform: translateX(0);
            display: block;
        }
        
        /* Search Container */
        .search-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .tool-search {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .tool-search:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
        }
        
        .search-container button {
            padding: 10px 12px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
        }
        
        .search-container button:hover {
            background: #0056CC;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }
        
        .search-container button:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(0, 122, 255, 0.2);
        }
        
        [data-theme="dark"] .tool-search {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .search-container button {
            background: #007AFF;
            color: white;
        }
        
        [data-theme="dark"] .search-container button:hover {
            background: #0056CC;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.4);
        }
        
        /* Category Buttons */
        .drug-categories,
        .lab-categories,
        .guideline-categories,
        .symptom-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }
        
        /* Specific styling for all category button containers */
        .drug-categories,
        .guidelines-categories,
        .lab-categories,
        .ddx-categories,
        .examination-categories,
        .triad-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: rgba(248, 249, 250, 0.5);
            border-radius: 12px;
            justify-content: flex-start;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .drug-categories,
            .guidelines-categories,
            .lab-categories,
            .ddx-categories,
            .examination-categories,
            .triad-categories {
                gap: 8px;
                padding: 6px 8px;
                margin-bottom: 16px;
            }
        }
        
        .category-btn {
            padding: 6px 12px;
            background: #f1f3f4;
            border: 1px solid #e5e5ea;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: #1c1c1e;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        /* Enhanced styling for all category buttons across tabs */
        .drug-categories .category-btn,
        .guidelines-categories .category-btn,
        .lab-categories .category-btn,
        .ddx-categories .category-btn,
        .examination-categories .category-btn,
        .triad-categories .category-btn {
            padding: 10px 18px;
            background: #ffffff;
            border: 2px solid #e5e5ea;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            color: #1c1c1e;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 768px) {
            .drug-categories .category-btn,
            .guidelines-categories .category-btn,
            .lab-categories .category-btn,
            .ddx-categories .category-btn,
            .examination-categories .category-btn,
            .triad-categories .category-btn {
                font-size: 13px;
                padding: 8px 15px;
                min-height: 36px;
                border-radius: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .drug-categories .category-btn,
            .guidelines-categories .category-btn,
            .lab-categories .category-btn,
            .ddx-categories .category-btn,
            .examination-categories .category-btn,
            .triad-categories .category-btn {
                font-size: 12px;
                padding: 6px 12px;
                min-height: 32px;
                border-radius: 18px;
            }
        }
        
        .category-btn:hover,
        .category-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        /* Enhanced button interactions for all category buttons */
        .drug-categories .category-btn:hover,
        .guidelines-categories .category-btn:hover,
        .lab-categories .category-btn:hover,
        .ddx-categories .category-btn:hover,
        .examination-categories .category-btn:hover,
        .triad-categories .category-btn:hover {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }
        
        .drug-categories .category-btn.active,
        .guidelines-categories .category-btn.active,
        .lab-categories .category-btn.active,
        .ddx-categories .category-btn.active,
        .examination-categories .category-btn.active,
        .triad-categories .category-btn.active {
            background: #007AFF;
            color: white;
            border-color: #0056CC;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.4);
            transform: translateY(-1px);
        }
        
        [data-theme="dark"] .category-btn {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        /* Dark theme for all category buttons */
        [data-theme="dark"] .drug-categories,
        [data-theme="dark"] .guidelines-categories,
        [data-theme="dark"] .lab-categories,
        [data-theme="dark"] .ddx-categories,
        [data-theme="dark"] .examination-categories,
        [data-theme="dark"] .triad-categories {
            background: rgba(44, 44, 46, 0.5);
        }
        
        [data-theme="dark"] .drug-categories .category-btn,
        [data-theme="dark"] .guidelines-categories .category-btn,
        [data-theme="dark"] .lab-categories .category-btn,
        [data-theme="dark"] .ddx-categories .category-btn,
        [data-theme="dark"] .examination-categories .category-btn,
        [data-theme="dark"] .triad-categories .category-btn {
            background: #2C2C2E;
            border-color: #48484A;
            color: #FFFFFF;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        [data-theme="dark"] .drug-categories .category-btn:hover,
        [data-theme="dark"] .guidelines-categories .category-btn:hover,
        [data-theme="dark"] .lab-categories .category-btn:hover,
        [data-theme="dark"] .ddx-categories .category-btn:hover,
        [data-theme="dark"] .examination-categories .category-btn:hover,
        [data-theme="dark"] .triad-categories .category-btn:hover {
            background: #007AFF;
            border-color: #007AFF;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
            transform: translateY(-2px);
        }
        
        [data-theme="dark"] .drug-categories .category-btn.active,
        [data-theme="dark"] .guidelines-categories .category-btn.active,
        [data-theme="dark"] .lab-categories .category-btn.active,
        [data-theme="dark"] .ddx-categories .category-btn.active,
        [data-theme="dark"] .examination-categories .category-btn.active,
        [data-theme="dark"] .triad-categories .category-btn.active {
            background: #007AFF;
            border-color: #0056CC;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.5);
            transform: translateY(-1px);
        }
        
        /* Back Button - Standardized across all medical tools */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #f1f3f4;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            color: #007AFF;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }
        
        .back-btn:hover {
            background: #e8eaed;
            border-color: #007AFF;
            transform: translateX(-2px);
        }
        
        .back-btn:active {
            transform: translateX(0);
            background: #dfe1e5;
        }
        
        [data-theme="dark"] .back-btn {
            background: #2a2a2a;
            border-color: #444;
            color: #007AFF;
        }
        
        [data-theme="dark"] .back-btn:hover {
            background: #333;
            border-color: #007AFF;
        }
        
        /* Detail View Container - Standardized for drug, lab, guideline, diagnosis, examination details */
        .drug-detail,
        .lab-detail,
        .guideline-detail,
        .diagnosis-detail,
        .examination-detail,
        .protocol-detail,
        .interpretation-detail {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] .drug-detail,
        [data-theme="dark"] .lab-detail,
        [data-theme="dark"] .guideline-detail,
        [data-theme="dark"] .diagnosis-detail,
        [data-theme="dark"] .examination-detail,
        [data-theme="dark"] .protocol-detail,
        [data-theme="dark"] .interpretation-detail {
            background: #1c1c1e;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Detail View Headers */
        .drug-detail h3,
        .lab-detail h3,
        .guideline-detail h3,
        .diagnosis-detail h3,
        .examination-detail h3,
        .protocol-detail h3,
        .interpretation-detail h3 {
            margin: 0 0 12px 0;
            font-size: 22px;
            font-weight: 700;
            color: #1c1c1e;
            line-height: 1.3;
        }
        
        [data-theme="dark"] .drug-detail h3,
        [data-theme="dark"] .lab-detail h3,
        [data-theme="dark"] .guideline-detail h3,
        [data-theme="dark"] .diagnosis-detail h3,
        [data-theme="dark"] .examination-detail h3,
        [data-theme="dark"] .protocol-detail h3,
        [data-theme="dark"] .interpretation-detail h3 {
            color: white;
        }
        
        /* Info Section - Standardized for all detail views */
        .info-section {
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .info-section:last-child {
            margin-bottom: 0;
        }
        
        .info-section.alert {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        [data-theme="dark"] .info-section {
            background: #2a2a2a;
            border-color: #444;
        }
        
        [data-theme="dark"] .info-section.alert {
            background: #4a3c1f;
            border-color: #ffc107;
        }
        
        .info-section h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 700;
            color: #1c1c1e;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        [data-theme="dark"] .info-section h4 {
            color: white;
        }
        
        .info-section p {
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
            color: #3c3c3e;
        }
        
        [data-theme="dark"] .info-section p {
            color: #e5e5ea;
        }
        
        /* Info Section Items - Standardized for all types */
        .stage-item,
        .group-item,
        .target-item,
        .treatment-item,
        .algorithm-item,
        .medication-item,
        .secondline-item,
        .monitoring-item,
        .contraindication-item,
        .special-population-item,
        .exacerbation-item,
        .nonpharm-item,
        .diagnosis-item,
        .assessment-item,
        .prevention-item,
        .acute-item,
        .rehab-item,
        .referral-item,
        .device-item,
        .surgery-item,
        .recurrent-item,
        .catheter-item,
        .inhaler-item,
        .admission-item,
        .severity-item,
        .antibiotic-item,
        .recognition-item,
        .definition-item,
        .management-item {
            padding: 10px 12px;
            background: white;
            border-left: 3px solid #007AFF;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .stage-item:last-child,
        .group-item:last-child,
        .target-item:last-child,
        .treatment-item:last-child,
        .algorithm-item:last-child,
        .medication-item:last-child,
        .secondline-item:last-child,
        .monitoring-item:last-child,
        .contraindication-item:last-child,
        .special-population-item:last-child,
        .exacerbation-item:last-child,
        .nonpharm-item:last-child,
        .diagnosis-item:last-child,
        .assessment-item:last-child,
        .prevention-item:last-child,
        .acute-item:last-child,
        .rehab-item:last-child,
        .referral-item:last-child,
        .device-item:last-child,
        .surgery-item:last-child,
        .recurrent-item:last-child,
        .catheter-item:last-child,
        .inhaler-item:last-child,
        .admission-item:last-child,
        .severity-item:last-child,
        .antibiotic-item:last-child,
        .recognition-item:last-child,
        .definition-item:last-child,
        .management-item:last-child {
            margin-bottom: 0;
        }
        
        [data-theme="dark"] .stage-item,
        [data-theme="dark"] .group-item,
        [data-theme="dark"] .target-item,
        [data-theme="dark"] .treatment-item,
        [data-theme="dark"] .algorithm-item,
        [data-theme="dark"] .medication-item,
        [data-theme="dark"] .secondline-item,
        [data-theme="dark"] .monitoring-item,
        [data-theme="dark"] .contraindication-item,
        [data-theme="dark"] .special-population-item,
        [data-theme="dark"] .exacerbation-item,
        [data-theme="dark"] .nonpharm-item,
        [data-theme="dark"] .diagnosis-item,
        [data-theme="dark"] .assessment-item,
        [data-theme="dark"] .prevention-item,
        [data-theme="dark"] .acute-item,
        [data-theme="dark"] .rehab-item,
        [data-theme="dark"] .referral-item,
        [data-theme="dark"] .device-item,
        [data-theme="dark"] .surgery-item,
        [data-theme="dark"] .recurrent-item,
        [data-theme="dark"] .catheter-item,
        [data-theme="dark"] .inhaler-item,
        [data-theme="dark"] .admission-item,
        [data-theme="dark"] .severity-item,
        [data-theme="dark"] .antibiotic-item,
        [data-theme="dark"] .recognition-item,
        [data-theme="dark"] .definition-item,
        [data-theme="dark"] .management-item {
            background: #1c1c1e;
            color: #e5e5ea;
        }
        
        .stage-item strong,
        .group-item strong,
        .target-item strong,
        .treatment-item strong,
        .algorithm-item strong,
        .medication-item strong,
        .secondline-item strong,
        .monitoring-item strong,
        .contraindication-item strong,
        .special-population-item strong,
        .exacerbation-item strong,
        .nonpharm-item strong,
        .diagnosis-item strong,
        .assessment-item strong,
        .prevention-item strong,
        .acute-item strong,
        .rehab-item strong,
        .referral-item strong,
        .device-item strong,
        .surgery-item strong,
        .recurrent-item strong,
        .catheter-item strong,
        .inhaler-item strong,
        .admission-item strong,
        .severity-item strong,
        .antibiotic-item strong,
        .recognition-item strong,
        .definition-item strong,
        .management-item strong {
            color: #007AFF;
            font-weight: 600;
        }
        
        /* Guideline Meta Information */
        .guideline-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e5ea;
        }
        
        [data-theme="dark"] .guideline-meta {
            border-bottom-color: #444;
        }
        
        .evidence-level,
        .last-updated {
            font-size: 13px;
            color: #8e8e93;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Tool Results */
        .tool-results {
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }
        
        .drug-item,
        .lab-item,
        .guideline-item,
        .differential-item {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .drug-item:hover,
        .lab-item:hover,
        .guideline-item:hover,
        .differential-item:hover {
            background: #e3f2fd;
            border-color: #007AFF;
        }
        
        .drug-item h4,
        .lab-item h4,
        .guideline-item h4,
        .differential-item h4 {
            margin: 0 0 4px 0;
            font-size: 14px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        .drug-class,
        .drug-indication,
        .lab-ranges,
        .lab-significance,
        .guideline-source,
        .guideline-summary {
            font-size: 12px;
            color: #8e8e93;
            margin: 2px 0;
        }
        
        [data-theme="dark"] .drug-item,
        [data-theme="dark"] .lab-item,
        [data-theme="dark"] .guideline-item,
        [data-theme="dark"] .differential-item {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .drug-item h4,
        [data-theme="dark"] .lab-item h4,
        [data-theme="dark"] .guideline-item h4,
        [data-theme="dark"] .differential-item h4 {
            color: var(--text-primary);
        }
        
        /* Calculator Grid */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .calculator-btn {
            padding: 16px 12px;
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .calculator-btn:hover {
            background: #e3f2fd;
            border-color: #007AFF;
            transform: translateY(-2px);
        }
        
        .calc-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .calc-name {
            font-size: 12px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        [data-theme="dark"] .calculator-btn {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .calc-name {
            color: var(--text-primary);
        }

        /* Lab Value Buttons - Standardized for all tabs */
        .lab-value-btn {
            padding: 16px 12px;
            background: #007AFF;
            border: 1px solid #007AFF;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            color: white;
        }
        
        .lab-value-btn:hover {
            background: #0056d6;
            border-color: #0056d6;
            transform: translateY(-2px);
        }
        
        .lab-name {
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }
        
        .lab-count {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        [data-theme="dark"] .lab-value-btn {
            background: #0056d6;
            border-color: #0056d6;
        }
        
        [data-theme="dark"] .lab-value-btn:hover {
            background: #003d99;
            border-color: #003d99;
        }

        /* Drug Cards */
        .drug-card {
            padding: 16px 12px;
            background: #007AFF;
            border: 1px solid #007AFF;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            color: white;
        }

        .drug-card:hover {
            background: #0056d6;
            border-color: #0056d6;
            transform: translateY(-2px);
        }

        .drug-name {
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }

        .drug-class {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.8);
        }

        [data-theme="dark"] .drug-card {
            background: #0056d6;
            border-color: #0056d6;
        }

        [data-theme="dark"] .drug-card:hover {
            background: #003d99;
            border-color: #003d99;
        }

        /* Lab Grid - Standardized grid for all card layouts */
        .lab-grid,
        #drug-list,
        #guidelines-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            .lab-grid,
            #drug-list,
            #guidelines-list {
                grid-template-columns: 1fr;
            }
        }
        
        /* Calculator Workspace */
        .calculator-workspace {
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 12px;
            min-height: 200px;
            display: none;
        }
        
        .calculator-workspace.active {
            display: block;
        }
        
        [data-theme="dark"] .calculator-workspace {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        /* Differential Diagnosis */
        .differential-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        
        .dx-item {
            padding: 4px 8px;
            background: #e3f2fd;
            color: #1565c0;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .dx-item.urgent {
            background: #ffebee;
            color: #c62828;
        }
        
        /* Clinical Triads Styling */
        .triads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            padding: 16px;
        }

        .triad-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .triad-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        [data-theme="dark"] .triad-card {
            background: #2a2a2a;
            border: 1px solid #444;
        }

        .triad-header h3 {
            margin: 0 0 8px 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }

        .urgency-badge {
            font-size: 0.7em;
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }

        .condition-name {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-bottom: 12px;
        }

        [data-theme="dark"] .condition-name {
            color: #aaa;
        }

        .triad-components h4 {
            margin: 12px 0 8px 0;
            font-size: 1em;
            color: #333;
        }

        [data-theme="dark"] .triad-components h4 {
            color: #ddd;
        }

        .components-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }

        .component-item {
            background: #f0f8ff;
            border: 1px solid #007AFF;
            color: #007AFF;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
        }

        [data-theme="dark"] .component-item {
            background: #1a2332;
            border-color: #4A90E2;
            color: #4A90E2;
        }

        .triad-details {
            border-top: 1px solid #eee;
            padding-top: 12px;
        }

        [data-theme="dark"] .triad-details {
            border-top-color: #444;
        }

        .detail-section {
            margin-bottom: 12px;
        }

        .detail-section h4 {
            margin: 0 0 4px 0;
            font-size: 0.9em;
            color: #333;
        }

        [data-theme="dark"] .detail-section h4 {
            color: #ddd;
        }

        .detail-section p {
            margin: 0;
            font-size: 0.85em;
            line-height: 1.4;
            color: #555;
        }

        [data-theme="dark"] .detail-section p {
            color: #bbb;
        }

        .uk-guidelines {
            background: #f8f9ff;
            padding: 8px;
            border-radius: 6px;
            border-left: 3px solid #007AFF;
        }

        [data-theme="dark"] .uk-guidelines {
            background: #1a1a2e;
            border-left-color: #4A90E2;
        }

        .uk-guidelines h4 {
            color: #007AFF !important;
        }

        [data-theme="dark"] .uk-guidelines h4 {
            color: #4A90E2 !important;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        [data-theme="dark"] .no-results {
            color: #aaa;
        }
        
        /* Emergency Protocols Styles */
        .emergency-categories, .interpretation-categories {
            display: flex;
            gap: 8px;
            padding: 16px;
            border-bottom: 1px solid #e5e5ea;
            flex-wrap: wrap;
        }
        
        .emergency-categories .category-btn, .interpretation-categories .category-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .emergency-categories .category-btn:hover, .interpretation-categories .category-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
            color: #374151;
        }
        
        .emergency-categories .category-btn.active, .interpretation-categories .category-btn.active {
            background: #007AFF;
            border-color: #007AFF;
            color: white;
        }
        
        .protocol-item, .interpretation-item {
            padding: 16px;
            border-bottom: 1px solid #e5e5ea;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .protocol-item:hover, .interpretation-item:hover {
            background: #f8f9fa;
        }
        
        .protocol-item.emergency {
            border-left: 4px solid #f44336;
        }
        
        .protocol-header, .interpretation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .protocol-header h4, .interpretation-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #1c1c1e;
            flex: 1;
        }
        
        .protocol-urgency {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .protocol-urgency.emergency {
            background: #ffebee;
            color: #c62828;
        }
        
        .protocol-urgency.high {
            background: #fff3e0;
            color: #e65100;
        }
        
        .protocol-urgency.moderate {
            background: #fff8e1;
            color: #f57c00;
        }
        
        .protocol-meta, .interpretation-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            font-size: 12px;
            color: #8e8e93;
        }
        
        .protocol-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .action-tag {
            padding: 2px 6px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .protocol-detail, .interpretation-detail {
            padding: 20px;
        }
        
        .protocol-detail-header, .interpretation-detail-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .protocol-detail-header h3, .interpretation-detail-header h3 {
            margin: 0;
            flex: 1;
            min-width: 200px;
        }
        
        .protocol-steps, .protocol-drugs, .protocol-critical, .interpretation-steps,
        .normal-values, .common-abnormalities, .compensation-rules, .emergency-findings {
            margin-bottom: 20px;
        }
        
        .protocol-steps h4, .protocol-drugs h4, .protocol-critical h4, .interpretation-steps h4,
        .normal-values h4, .common-abnormalities h4, .compensation-rules h4, .emergency-findings h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        .step-list, .drug-list, .critical-list, .values-list, .abnormalities-list,
        .compensation-list, .emergency-list {
            margin: 0;
            padding-left: 20px;
        }
        
        .step-list li, .drug-list li, .critical-list li, .values-list li,
        .abnormalities-list li, .compensation-list li, .emergency-list li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .interpretation-type, .step-count {
            padding: 2px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .interpretation-preview {
            margin-top: 8px;
        }
        
        .step-preview {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .suicide-warning {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 12px;
            margin: 12px 0;
            border-radius: 4px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 8px 0;
        }
        
        /* Dark mode styles for new components */
        [data-theme="dark"] .emergency-categories, [data-theme="dark"] .interpretation-categories {
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .emergency-categories .category-btn, [data-theme="dark"] .interpretation-categories .category-btn {
            background: #2a2a2a;
            border-color: #444;
            color: #ddd;
        }
        
        [data-theme="dark"] .emergency-categories .category-btn:hover, [data-theme="dark"] .interpretation-categories .category-btn:hover {
            background: #1a2332;
            border-color: #4A90E2;
            color: #4A90E2;
        }
        
        [data-theme="dark"] .emergency-categories .category-btn.active, [data-theme="dark"] .interpretation-categories .category-btn.active {
            background: #4A90E2;
            border-color: #4A90E2;
            color: white;
        }
        
        [data-theme="dark"] .protocol-item, [data-theme="dark"] .interpretation-item {
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .protocol-item:hover, [data-theme="dark"] .interpretation-item:hover {
            background: var(--bg-tertiary);
        }
        
        [data-theme="dark"] .protocol-header h4, [data-theme="dark"] .interpretation-header h4,
        [data-theme="dark"] .protocol-steps h4, [data-theme="dark"] .protocol-drugs h4,
        [data-theme="dark"] .protocol-critical h4, [data-theme="dark"] .interpretation-steps h4,
        [data-theme="dark"] .normal-values h4, [data-theme="dark"] .common-abnormalities h4,
        [data-theme="dark"] .compensation-rules h4, [data-theme="dark"] .emergency-findings h4 {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .protocol-meta, [data-theme="dark"] .interpretation-meta,
        [data-theme="dark"] .step-preview {
            color: var(--text-secondary);
        }
        
        /* Interactive Features Styles - Bookmark functionality removed */
        
        .calculator-notes {
            margin-top: 20px;
            padding: 16px;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .notes-header h4 {
            margin: 0;
            font-size: 14px;
            color: #666;
        }
        
        .notes-toggle {
            background: none;
            border: 1px solid #ddd;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .quick-access-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .quick-access-tabs {
            display: flex;
            border-bottom: 1px solid #e5e5ea;
            background: #f8f9fa;
        }
        
        .quick-tab {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #8e8e93;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .quick-tab:hover {
            background: #e5e5ea;
            color: #1c1c1e;
        }
        
        .quick-tab.active {
            color: #007AFF;
            border-bottom-color: #007AFF;
            background: white;
        }
        
        .quick-access-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .quick-tab-content {
            display: none;
            padding: 16px;
        }
        
        .quick-tab-content.active {
            display: block;
        }
        
        .quick-tool-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e5e5ea;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .quick-tool-item:hover {
            background: #f8f9fa;
        }
        
        .tool-name {
            font-weight: 500;
            color: #1c1c1e;
            flex: 1;
        }
        
        .tool-time, .tool-frequency {
            font-size: 12px;
            color: #8e8e93;
        }
        
        .remove-bookmark {
            background: none;
            border: none;
            font-size: 14px;
            color: #ff3b30;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .remove-bookmark:hover {
            background: #ffebee;
        }
        
        .no-items {
            text-align: center;
            color: #8e8e93;
            font-style: italic;
            padding: 40px 20px;
        }
        
        .lab-test-item {
            padding: 16px;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            margin-bottom: 12px;
            background: white;
        }
        
        .lab-test-item.critical-test {
            border-left: 4px solid #f44336;
            background: #fff5f5;
        }
        
        .lab-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .lab-test-header h4 {
            margin: 0;
            color: #1c1c1e;
            font-size: 16px;
        }
        
        .lab-panel {
            font-size: 12px;
            color: #8e8e93;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .lab-test-values {
            margin-bottom: 12px;
        }
        
        .normal-range, .critical-range {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .critical-range {
            color: #f44336;
            font-weight: 600;
        }
        
        .lab-test-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }
        
        .lab-interpretation {
            border-top: 1px solid #e5e5ea;
            padding-top: 12px;
        }
        
        .interpretation-section {
            margin-bottom: 8px;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .interpretation-section.critical {
            color: #f44336;
            font-weight: 600;
        }
        
        .lab-values-header {
            padding: 16px;
            border-bottom: 1px solid #e5e5ea;
            background: #f8f9fa;
        }
        
        .lab-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .lab-filters select {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .lab-filters label {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Dark mode styles for interactive features */
        [data-theme="dark"] .calculator-notes {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .notes-header h4 {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .quick-access-tabs {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .quick-tab {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .quick-tab:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .quick-tab.active {
            background: var(--bg-secondary);
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }
        
        [data-theme="dark"] .quick-tool-item {
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .quick-tool-item:hover {
            background: var(--bg-tertiary);
        }
        
        [data-theme="dark"] .tool-name {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .tool-time,
        [data-theme="dark"] .tool-frequency {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .lab-test-item {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .lab-test-item.critical-test {
            background: #2a1f1f;
        }
        
        [data-theme="dark"] .lab-test-header h4 {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .lab-panel {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .lab-test-description {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .lab-interpretation {
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .lab-values-header {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        /* Mobile Responsive */
        @media (max-width: 480px) {
            .medical-tools-panel {
                width: 100vw;
                right: -100vw;
            }
            
            .medical-tools-toggle {
                bottom: 70px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .calculator-grid {
                grid-template-columns: 1fr;
            }
            
            /* Triads mobile responsive */
            .triads-grid {
                grid-template-columns: 1fr;
                padding: 12px;
                gap: 12px;
            }
            
            .triad-header h3 {
                font-size: 1.1em;
            }
            
            .urgency-badge {
                font-size: 0.6em;
            }
            
            .components-list {
                gap: 4px;
            }
            
            .component-item {
                font-size: 0.8em;
                padding: 3px 6px;
            }
            
            .triad-categories {
                padding: 12px;
                gap: 6px;
            }
            
            .triad-categories .category-btn {
                font-size: 0.8em;
                padding: 5px 10px;
            }
            
            .tool-nav-btn {
                font-size: 11px;
                padding: 10px 12px;
                min-width: fit-content;
                flex: 1 1 auto;
            }
            
            .tools-navigation {
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
                gap: 2px;
            }
            
            .tools-navigation::-webkit-scrollbar {
                display: none;
            }
        }
        
        /* Calculator Form Styles */
        .calculator-form {
            padding: 16px;
        }
        
        .calculator-form h4 {
            margin: 0 0 8px 0;
            color: #1c1c1e;
            font-size: 16px;
            font-weight: 600;
        }
        
        .calc-input-group {
            margin-bottom: 12px;
        }
        
        /* Enhanced Medical Tools Panel Content Styling */
        .critical-values {
            background: rgba(255, 59, 48, 0.1);
            border-left: 4px solid #ff3b30;
            padding: 12px;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .critical-values h4 {
            color: #ff3b30;
            margin: 0 0 8px 0;
        }
        
        .red-flags-banner {
            background: rgba(255, 69, 58, 0.1);
            border: 2px solid #ff453a;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .red-flags-banner h4 {
            color: #ff453a;
            margin: 0 0 8px 0;
            font-size: 16px;
        }
        
        .urgency-banner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-weight: 600;
        }
        
        .urgency-banner.emergency {
            background: rgba(255, 59, 48, 0.15);
            border: 2px solid #ff3b30;
            color: #ff3b30;
        }
        
        .urgency-banner.urgent {
            background: rgba(255, 149, 0, 0.15);
            border: 2px solid #ff9500;
            color: #ff9500;
        }
        
        .urgency-banner.non-urgent {
            background: rgba(52, 199, 89, 0.15);
            border: 2px solid #34c759;
            color: #34c759;
        }
        
        .guideline-meta {
            display: flex;
            gap: 16px;
            margin: 16px 0;
            font-size: 14px;
        }
        
        .evidence-level {
            background: rgba(0, 122, 255, 0.1);
            color: #007AFF;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .last-updated {
            background: rgba(142, 142, 147, 0.1);
            color: #8e8e93;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .stage-item, .group-item, .target-item, .treatment-item,
        .algorithm-item, .medication-item, .secondline-item,
        .monitoring-item, .contraindication-item, .special-population-item,
        .exacerbation-item, .nonpharm-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(142, 142, 147, 0.2);
        }
        
        .stage-item:last-child, .group-item:last-child, .target-item:last-child,
        .treatment-item:last-child, .algorithm-item:last-child, .medication-item:last-child,
        .secondline-item:last-child, .monitoring-item:last-child, .contraindication-item:last-child,
        .special-population-item:last-child, .exacerbation-item:last-child, .nonpharm-item:last-child {
            border-bottom: none;
        }
        
        .ddx-key-features {
            font-size: 12px;
            color: #007AFF;
            margin-top: 4px;
            font-style: italic;
        }
        
        .ddx-item.emergency {
            border-left: 4px solid #ff3b30;
        }
        
        .ddx-item.urgent {
            border-left: 4px solid #ff9500;
        }
        
        .ddx-item.non-urgent {
            border-left: 4px solid #34c759;
        }
        
        .time-to-treat {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .alert {
            background: rgba(255, 204, 0, 0.1);
            border: 2px solid #ffcc00;
            border-radius: 8px;
            padding: 16px;
        }
        
        .alert h4 {
            color: #ffcc00;
        }
        
        [data-theme="dark"] .critical-values {
            background: rgba(255, 69, 58, 0.2);
            border-left-color: #ff453a;
        }
        
        [data-theme="dark"] .critical-values h4 {
            color: #ff453a;
        }
        
        [data-theme="dark"] .red-flags-banner {
            background: rgba(255, 69, 58, 0.2);
            border-color: #ff453a;
        }
        
        [data-theme="dark"] .red-flags-banner h4 {
            color: #ff453a;
        }
        
        [data-theme="dark"] .urgency-banner.emergency {
            background: rgba(255, 69, 58, 0.2);
            border-color: #ff453a;
            color: #ff453a;
        }
        
        [data-theme="dark"] .urgency-banner.urgent {
            background: rgba(255, 159, 10, 0.2);
            border-color: #ff9f0a;
            color: #ff9f0a;
        }
        
        [data-theme="dark"] .urgency-banner.non-urgent {
            background: rgba(50, 215, 75, 0.2);
            border-color: #32d74b;
            color: #32d74b;
        }
        
        [data-theme="dark"] .evidence-level {
            background: rgba(10, 132, 255, 0.2);
            color: #0a84ff;
        }
        
        [data-theme="dark"] .last-updated {
            background: rgba(174, 174, 178, 0.2);
            color: #aeaeb2;
        }
        
        [data-theme="dark"] .ddx-key-features {
            color: #0a84ff;
        }
        
        [data-theme="dark"] .ddx-item.emergency {
            border-left-color: #ff453a;
        }
        
        [data-theme="dark"] .ddx-item.urgent {
            border-left-color: #ff9f0a;
        }
        
        [data-theme="dark"] .ddx-item.non-urgent {
            border-left-color: #32d74b;
        }
        
        [data-theme="dark"] .alert {
            background: rgba(255, 214, 10, 0.2);
            border-color: #ffd60a;
        }
        
        [data-theme="dark"] .alert h4 {
            color: #ffd60a;
        }
        
        /* Loading Message Styling */
        .loading-message {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: #8e8e93;
            font-style: italic;
            text-align: center;
        }
        
        [data-theme="dark"] .loading-message {
            color: #aeaeb2;
        }
        
        .calc-input-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #1c1c1e;
            margin-bottom: 4px;
        }
        
        .calc-input-group input,
        .calc-select-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e5e5ea;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .calc-input-group input:focus,
        .calc-select-group select:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
        }
        
        .calc-select-group {
            margin-bottom: 12px;
        }
        
        .calc-checkbox-group {
            margin-bottom: 16px;
        }
        
        .calc-checkbox-group label {
            display: flex;
            align-items: center;
            font-size: 13px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .calc-checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }
        
        .calculator-form button {
            width: 100%;
            padding: 12px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 16px;
        }
        
        .calculator-form button:hover {
            background: #0056cc;
        }
        
        .calc-result {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .calc-reference {
            padding: 8px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            font-size: 11px;
            color: #856404;
        }
        
        .calc-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            border-left: 4px solid #007AFF;
        }
        
        .calc-section h5 {
            margin: 0 0 12px 0;
            color: #007AFF;
            font-size: 14px;
            font-weight: 600;
        }
        
        .bmi-result-display,
        .score-result,
        .gcs-result-display,
        .apache-result-display,
        .wells-result-display {
            text-align: center;
        }
        
        .bmi-value,
        .score-value,
        .gcs-total,
        .wells-score {
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .bmi-category,
        .score-risk,
        .score-recommendation,
        .gcs-severity,
        .wells-probability,
        .wells-recommendation {
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .gcs-breakdown {
            font-size: 12px;
            color: #8e8e93;
            margin-bottom: 8px;
        }
        
        .error {
            color: #F44336;
            font-size: 14px;
            text-align: center;
        }
        
        [data-theme="dark"] .calculator-form h4,
        [data-theme="dark"] .calc-input-group label {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .calc-input-group input,
        [data-theme="dark"] .calc-select-group select {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .calc-result {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .calc-reference {
            background: #2d2a1f;
            border-color: #4a3f2a;
            color: #e6d576;
        }
        
        [data-theme="dark"] .calc-section {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .calc-section h5 {
            color: var(--accent-color);
        }
        
        .calc-error {
            color: #F44336;
        }
        
        .calc-success {
            color: #4CAF50;
        }
        
        .calc-note {
            color: #666;
        }
        
        [data-theme="dark"] .calc-error {
            color: #ff6b6b;
        }
        
        [data-theme="dark"] .calc-success {
            color: #51cf66;
        }
        
        [data-theme="dark"] .calc-note {
            color: var(--text-secondary);
        }
        
        /* Quiz Length Selection Styling */
        .quiz-length-btn {
            padding: 12px 8px;
            border: 2px solid #e5e5ea;
            border-radius: 8px;
            background: white;
            color: #1c1c1e;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-family: inherit;
        }
        
        .quiz-length-btn .btn-number {
            font-size: 18px;
            font-weight: bold;
            line-height: 1;
        }
        
        .quiz-length-btn .btn-description {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .quiz-length-btn:hover {
            border-color: #007AFF;
            background: #f0f8ff;
            color: #007AFF;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
        }
        
        .quiz-length-btn.active {
            border-color: #007AFF;
            background: #007AFF;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }
        
        .quiz-length-btn.active .btn-description {
            opacity: 0.9;
        }
        
        .quiz-length-btn.active:hover {
            background: #0056cc;
            border-color: #0056cc;
        }
        
        [data-theme="dark"] .quiz-length-btn {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .quiz-length-btn:hover {
            border-color: var(--button-bg);
            background: var(--bg-tertiary);
            color: var(--button-bg);
        }
        
        [data-theme="dark"] .quiz-length-btn.active {
            background: var(--button-bg);
            border-color: var(--button-bg);
            color: white;
        }
        
        @media (max-width: 480px) {
            .quiz-length-options {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }
            
            .quiz-length-btn {
                padding: 10px 12px;
            }
        }
        
        /* Responsive font controls for mobile */
        .font-controls {
            position: absolute;
            right: 200px;
            display: flex;
            gap: 5px;
            align-items: center;
            z-index: 1001;
        }
        
        .haptics-controls {
            position: absolute;
            left: 200px;
            display: flex;
            gap: 5px;
            align-items: center;
            z-index: 1001;
        }
        
        .haptics-btn {
            background: transparent;
            border: 1px solid #007AFF;
            color: #007AFF;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            min-width: 32px;
        }
        
        [data-theme="dark"] .haptics-btn {
            border-color: #0A84FF;
            color: #0A84FF;
        }
        
        @media (max-width: 768px) {
            .font-controls {
                right: 10px !important;
                top: 50px !important;
                gap: 3px !important;
            }
            
            .haptics-controls {
                left: 10px !important;
                top: 50px !important;
            }
            
            .haptics-btn {
                padding: 4px 8px !important;
                min-width: 28px !important;
                font-size: 14px !important;
            }
            
            .font-size-btn {
                padding: 3px 5px !important;
                min-width: 18px !important;
                font-size: 8px !important;
            }
            
            .font-size-btn[data-size="medium"] {
                font-size: 9px !important;
            }
            
            .font-size-btn[data-size="large"] {
                font-size: 10px !important;
            }
            
            .font-size-btn[data-size="xlarge"] {
                font-size: 11px !important;
            }
        }
        
        @media (max-width: 480px) {
            .font-controls {
                right: 5px !important;
                top: 55px !important;
                gap: 2px !important;
            }
            
            .haptics-controls {
                left: 5px !important;
                top: 55px !important;
            }
            
            .haptics-btn {
                padding: 3px 6px !important;
                min-width: 24px !important;
                font-size: 12px !important;
            }
            
            .font-size-btn {
                padding: 2px 4px !important;
                min-width: 16px !important;
            }
        }

        /* Long medical lines should wrap gracefully */
        .q-text {
            overflow-wrap: anywhere;
            word-break: break-word;
            white-space: pre-wrap;
            width: 100%;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .investigations {
            overflow-wrap: anywhere;
            word-break: break-word;
            white-space: normal;
            width: 100%;
        }

        .q-text {
            margin: 0 0 12px 0;
        }
        
        .q-text p { 
            margin: 0 0 1px;
            line-height: 1.4;
        }
        
        .q-text p:last-child {
            margin-bottom: 0;
        }

        /* Question container improvements */
        .question-container {
            width: 100%;
            max-width: none;
        }

        .question-container.active {
            display: block;
            width: 100%;
        }

        /* Investigations block styling */
        .investigations {
            margin: 0 0 12px 0;
            padding: 1px 8px 3px 12px;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-left: 4px solid #2563eb;
            border-radius: 8px;
            width: 100%;
        }
        .investigations h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
        }
        .investigations div,
        .investigations p { 
            margin: 0;
            padding: 0;
            line-height: 1.4;
            font-size: 1rem;
        }
        
        .investigations br {
            line-height: 0;
            margin: 0;
            padding: 0;
            display: block;
            height: 6px;
            font-size: 0;
        }

        /* Options list */
        .new-options {
            display: grid;
            gap: 6px;
            margin: 0;
        }

        /* Each option as a "chip card" */
        .new-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 14px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #fff;
            cursor: pointer;
            transition: border-color .15s, box-shadow .15s, background .15s;
            width: 100%;
            min-height: 44px;
        }

        .new-option input[type="radio"] {
            margin-top: 2px;
            flex: 0 0 auto;
        }

        .new-option:hover {
            border-color: #c7d2fe;
            box-shadow: 0 2px 8px rgba(37,99,235,.08);
            background: #fbfdff;
        }

        .new-option:has(input:checked) {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37,99,235,.15) inset;
        }

        /* Fallback for browsers that don't support :has() */
        .new-option.selected {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37,99,235,.15) inset;
        }

        /* Feedback states */
        .new-option.correct {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .new-option.incorrect {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        /* Ruled out state - user marked as eliminated */
        .new-option.ruled-out {
            opacity: 0.5;
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .new-option.ruled-out .label {
            text-decoration: line-through;
            color: #6b7280;
        }

        /* Label text wraps; letters stand out */
        .new-option .label {
            overflow-wrap: anywhere;
        }
        .new-option .badge {
            font-weight: 700;
            margin-right: 6px;
        }

        /* Progress rail */
        .progress-card h4 { 
            margin: 0 0 8px; 
        }
        .progress-list { 
            display: grid; 
            gap: 8px; 
        }
        .progress-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-size: 0.92rem; 
            padding: 6px 8px; 
            border-radius: 8px;
            background: #f3f4f6;
        }
        .progress-bar {
            height: 6px; 
            background: #e5e7eb; 
            border-radius: 999px; 
            overflow: hidden;
        }
        .progress-bar > span {
            display: block; 
            height: 100%; 
            width: var(--w,0%);
            background: #2563eb;
        }

        /* Spacing and headings */
        .section-title {
            margin: 0;
            font-size: 1.05rem;
            font-weight: 800;
            color: #0f172a;
        }

        /* Quiz controls */
        .quiz-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }

        .submit-btn, .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn {
            background: #2563eb;
            color: white;
        }

        .submit-btn:hover {
            background: #1d4ed8;
        }

        .nav-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .nav-btn:hover {
            background: #e5e7eb;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Top navigation buttons */
        .nav-btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(4px);
        }
        
        .nav-btn-small:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .nav-btn-small:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Flag button */
        .flag-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            opacity: 0.7;
        }
        
        .flag-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .flag-btn.flagged {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Feedback and explanation styling */
        .feedback-container {
            margin: 16px 0;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
        }

        .feedback-container.correct {
            background: #ecfdf5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .feedback-container.incorrect {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .explanation-container {
            margin: 16px 0;
            padding: 16px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .explanation-container h4 {
            margin: 0 0 8px 0;
            color: #475569;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .explanation-container p {
            font-size: 1rem;
            line-height: 1.4;
            margin: 0 0 8px 0;
        }

        .explanation-container p:last-child {
            margin-bottom: 0;
        }

        /* Link wrapping in explanations */
        .explanation-container a,
        .explanation-content a,
        .explanation-link {
            word-wrap: break-word;
            word-break: break-all;
            overflow-wrap: anywhere;
            hyphens: auto;
            color: #007AFF;
            text-decoration: underline;
            display: inline-block;
            max-width: 100%;
        }
        
        /* Specific mobile handling for long URLs */
        @media (max-width: 480px) {
            .explanation-container a,
            .explanation-content a,
            .explanation-link {
                font-size: 14px;
                line-height: 1.3;
                word-break: break-all;
                overflow-wrap: anywhere;
                hyphens: none;
                /* Force wrapping on any character if needed */
                word-wrap: break-word;
            }
            
            .explanation-container,
            .explanation-content {
                overflow-wrap: anywhere;
                word-break: break-word;
            }
        }
        
        /* iOS-Style Cards */
        .card {
            background: white;
            margin: 16px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            padding: 16px 16px 8px 16px;
            border-bottom: 0.5px solid #e5e5ea;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 4px 0;
            color: #1c1c1e;
        }
        
        .card-subtitle {
            font-size: 15px;
            color: #8e8e93;
            margin: 0;
        }
        
        .card-content {
            padding: 16px;
        }
        
        /* Quiz List Styles */
        .quiz-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid #e5e5ea;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .quiz-item:last-child {
            border-bottom: none;
        }
        
        .quiz-item:active {
            background: #e5e5ea;
        }
        
        .quiz-info {
            flex: 1;
        }
        
        .quiz-name {
            font-size: 17px;
            font-weight: 400;
            margin: 0 0 2px 0;
            color: #1c1c1e;
        }
        
        .quiz-details {
            font-size: 13px;
            color: #8e8e93;
            margin: 0;
        }
        
        .chevron {
            color: #c7c7cc;
            font-size: 14px;
        }
        
        /* Question Styles */
        .question-container {
            display: none;
        }
        
        .question-container.active {
            display: block;
        }
        
        .question-header {
            padding: 16px;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
        }
        
        .question-number {
            font-size: 15px;
            opacity: 0.8;
            margin: 0 0 4px 0;
        }
        
        .question-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .question-content {
            padding: 20px;
        }
        
        .scenario {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 20px;
            color: #1c1c1e;
        }
        
        .investigations-title {
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #1c1c1e;
            font-size: 16px;
        }
        
        .investigations-content {
            font-size: 15px;
            line-height: 1.4;
            margin: 0;
            white-space: pre-line;
            color: #3a3a3c;
        }
        
        .prompt {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 8px 0 20px 0;
            color: #1c1c1e;
        }
        
        /* iOS-Style Options */
        .options {
            margin: 20px 0;
        }
        
        .option {
            background: white;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }
        
        .option:hover {
            border-color: #007AFF;
        }
        
        .option.selected {
            border-color: #007AFF;
            background: #f0f8ff;
        }
        
        .option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .option-content {
            padding: 16px;
            font-size: 16px;
            line-height: 1.4;
        }
        
        /* Feedback Styles */
        .feedback-container {
            margin: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            text-align: center;
        }
        
        .feedback-correct {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .feedback-incorrect {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        
        /* Question Sidebar Styles */
        .question-sidebar {
            position: fixed;
            top: 60px;
            right: 0;
            width: 280px;
            height: calc(100vh - 60px);
            background: white;
            border-left: 1px solid #e5e5ea;
            transform: translateX(240px);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 0 12px;
            box-sizing: border-box;
        }
        
        .question-sidebar.expanded {
            transform: translateX(0);
        }
        
        .sidebar-header {
            padding: 16px 0;
            border-bottom: 1px solid #e5e5ea;
            background: #f8f9fa;
            margin: 0 -12px;
            padding-left: 12px;
            padding-right: 12px;
        }
        
        .sidebar-title {
            font-weight: 600;
            font-size: 18px;
            color: #1c1c1e;
        }
        
        .sidebar-stats {
            font-size: 14px;
            color: #8e8e93;
            margin-top: 4px;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 16px;
            left: -40px;
            width: 40px;
            height: 40px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .sidebar-content {
            padding: 8px 0;
            margin: 0 -12px;
            padding-left: 12px;
            padding-right: 12px;
        }
        
        .question-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            border-bottom: 0.5px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .question-item:hover {
            background: #f8f9fa;
        }
        
        .question-item.current {
            background: #e3f2fd;
            border-left: 3px solid #007AFF;
        }
        
        .question-number {
            font-weight: 600;
            font-size: 14px;
            width: 30px;
        }
        
        .question-status {
            margin-left: auto;
            font-size: 16px;
        }
        
        .quiz-main-content {
            margin-right: 40px;
            transition: margin-right 0.3s ease;
        }
        
        .quiz-main-content.sidebar-expanded {
            margin-right: 280px;
        }
        
        /* Explanation Styles */
        .explanation-container {
            margin: 16px;
            padding: 16px;
            background: #f8f9fa;
            border-left: 4px solid #007AFF;
            border-radius: 8px;
        }
        
        .explanation-title {
            font-weight: 600;
            color: #007AFF;
            margin-bottom: 8px;
        }
        
        .explanation-content {
            font-size: 15px;
            line-height: 1.4;
            color: #1c1c1e;
        }
        
        /* iOS-Style Buttons */
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            padding: 14px 24px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin: 8px 0;
        }
        
        .btn:hover {
            background: #0056cc;
        }
        
        .btn:disabled {
            background: #8e8e93;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #8e8e93;
        }
        
        .btn-secondary:hover {
            background: #636366;
        }
        
        /* Progress Bar */
        .progress-container {
            padding: 16px;
            background: white;
            border-bottom: 0.5px solid #e5e5ea;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e5ea;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #007AFF;
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            text-align: center;
            font-size: 15px;
            color: #8e8e93;
            margin-top: 8px;
        }
        
        /* Results Styles */
        .quiz-item.uploaded-quiz {
            border-left: 3px solid #007AFF;
        }
        
        .quiz-item.uploaded-quiz .quiz-name {
            color: #007AFF;
        }
        
        .file-upload-container {
            text-align: center;
        }
        
        /* Results Container */
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
        
        .score-card {
            background: linear-gradient(135deg, #34C759 0%, #00C957 100%);
            color: white;
            text-align: center;
            padding: 32px 16px;
            margin: 16px;
            border-radius: 16px;
        }
        
        .score-percentage {
            font-size: 48px;
            font-weight: 700;
            margin: 0;
        }
        
        .score-details {
            font-size: 17px;
            opacity: 0.9;
            margin: 8px 0 0 0;
        }
        
        /* Loading States */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .loading p {
            color: #8e8e93;
            margin: 10px 0 0 0;
        }
        
        /* Dark mode for loading states */
        [data-theme="dark"] .loading {
            color: #aeaeb2;
        }
        
        [data-theme="dark"] .loading p {
            color: #aeaeb2;
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid #e5e5ea;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        /* Dark mode for spinner */
        [data-theme="dark"] .spinner {
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--button-bg);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile-specific sidebar adjustments */
        @media (max-width: 767px) {
            .question-sidebar {
                width: calc(100vw - 30px);
                transform: translateX(calc(100vw - 15px));
                padding: 0 15px;
            }
            
            .question-sidebar.expanded {
                transform: translateX(0);
            }
        }
        
        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                max-width: 600px;
                margin: 0 auto;
            }
        }
        
        /* Haptic visual feedback */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, var(--haptic-flash));
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.1s ease;
        }
        
        [data-theme="dark"] body::before {
            background: rgba(0, 0, 0, var(--haptic-flash));
        }
        
        /* Safe Area Support for iPhone */
        @supports (padding: max(0px)) {
            .navbar {
                padding-top: max(8px, env(safe-area-inset-top));
            }
            
            body {
                padding-top: env(safe-area-inset-top);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <button class="back-btn" id="backBtn" style="display: none;">← Back</button>
        <h1 id="navTitle">MLA Quiz</h1>
        <button class="next-btn" id="nextNavBtn" style="display: none;">Next →</button>
    </nav>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Quiz Selection Screen -->
        <div id="quizSelection" class="screen active">
            <div class="card">
                <div class="card-header" style="padding-top: 32px;">
                    <h2 class="card-title">Medical Licensing Assessment (MLA)</h2>
                    <p class="card-subtitle">Select a quiz to begin</p>
                </div>
                
                <!-- File Upload Section -->
                <div class="card-content" style="border-bottom: 1px solid #e5e5ea; margin-bottom: 16px;">
                    <h3 style="font-size: 17px; font-weight: 600; margin: 0 0 8px 0; color: #1c1c1e;">Upload Quiz Files</h3>
                    <p style="font-size: 15px; color: #8e8e93; margin: 0 0 16px 0;">Upload .md files or .zip files containing quiz questions and images</p>
                    
                    <div class="file-upload-container">
                        <input type="file" id="quizFileInput" accept=".md,.zip" multiple style="display: none;">
                        <button class="btn" id="uploadBtn" style="margin-bottom: 8px; background: #34c759;">
                            📁 Choose Quiz Files
                        </button>
                        <button class="btn btn-secondary" id="clearUploaded" style="margin-bottom: 8px; background: #ff3b30;" onclick="if(confirm('Clear all uploaded quizzes? This will free up browser storage space.')) { 
                            // Clear localStorage
                            const uploadedQuizzes = JSON.parse(localStorage.getItem('uploadedQuizzes') || '[]');
                            uploadedQuizzes.forEach(quiz => {
                                if (quiz.dataStored === 'split') {
                                    localStorage.removeItem('quiz_' + quiz.name);
                                }
                            });
                            localStorage.removeItem('uploadedQuizzes'); 
                            // Clear temporary storage
                            if (window.tempUploadedQuizzes) {
                                window.tempUploadedQuizzes = [];
                            }
                            location.reload(); 
                        }">
                            🗑️ Clear Uploaded
                        </button>
                        <div id="uploadStatus" style="font-size: 14px; color: #8e8e93; margin-top: 8px;"></div>
                        <div style="font-size: 12px; color: #8e8e93; margin-top: 8px; font-style: italic;">
                            💡 Tip: Right-click (or long-press on mobile) answer options to rule them out with a strikethrough
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Length Selection -->
                <div class="card-content" style="border-bottom: 1px solid #e5e5ea; margin-bottom: 16px;">
                    <h3 style="font-size: 17px; font-weight: 600; margin: 0 0 8px 0; color: #1c1c1e;">Quiz Length</h3>
                    <p style="font-size: 15px; color: #8e8e93; margin: 0 0 16px 0;">Choose how many questions you want to practice</p>
                    
                    <div class="quiz-length-options" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <button class="quiz-length-btn active" data-length="20">
                            <div class="btn-number">20</div>
                            <div class="btn-description">Quick Practice</div>
                        </button>
                        
                        <button class="quiz-length-btn" data-length="100">
                            <div class="btn-number">100</div>
                            <div class="btn-description">Standard Test</div>
                        </button>
                        
                        <button class="quiz-length-btn" data-length="all">
                            <div class="btn-number">ALL</div>
                            <div class="btn-description">Full Practice</div>
                        </button>
                    </div>
                    
                    <div id="quiz-length-info" style="font-size: 13px; color: #8e8e93; margin-top: 12px; text-align: center;">
                        📝 Selected: 20 questions for quick practice session
                    </div>
                </div>
                
                <div id="quizList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading available quizzes...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quizScreen" class="screen" style="display: none;">
            <div class="quiz-page">
                <main class="card">
                    <div class="q-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                            <button id="prevBtnTop" class="nav-btn-small" style="display: none;">← Prev</button>
                            <div style="font-size:.8rem;opacity:.9">Question</div>
                            <button id="nextBtnTop" class="nav-btn-small" style="display: none;">Next →</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 style="margin:0" id="questionTitle">Question 1</h2>
                            <button id="flagBtn" class="flag-btn" title="Flag this question">🚩</button>
                        </div>
                        <div style="font-size:.85rem;opacity:.9" id="questionProgress">1 of 49</div>
                    </div>
                    
                    <div class="card-body">
                        <div id="questionContainer" class="question-container active">
                            <!-- Questions will be loaded here -->
                        </div>
                        
                        <div id="feedbackContainer" class="feedback-container" style="display: none;">
                            <!-- Feedback will be shown here -->
                        </div>
                        
                        <div id="explanationContainer" class="explanation-container" style="display: none;">
                            <!-- Explanations will be shown here -->
                        </div>
                        
                        <div class="quiz-controls">
                            <button id="prevBtn" class="nav-btn" style="display: none;">Previous</button>
                            <button id="submitBtn" class="submit-btn">Submit Answer</button>
                            <button id="nextBtn" class="nav-btn" style="display: none;">Next</button>
                        </div>
                    </div>
                </main>

                <aside class="sidebar">
                    <div class="card">
                        <div class="card-body progress-card">
                            <h4>Progress</h4>
                            <div class="progress-bar">
                                <span id="progressFill" style="--w: 0%"></span>
                            </div>
                            <div class="progress-list">
                                <div class="progress-item">
                                    <span>Completed</span>
                                    <span id="completedCount">0/0</span>
                                </div>
                                <div class="progress-item">
                                    <span>Correct</span>
                                    <span id="correctCount">0 (0%)</span>
                                </div>
                                
                                <!-- Time tracking display -->
                                <div id="time-display" class="time-display" style="margin-top: 15px; padding: 10px; border-top: 1px solid #e5e5ea;">
                                    <div class="time-stats">
                                        <span>Time tracking will appear here</span>
                                    </div>
                                </div>
                            </div>
                            <div id="sidebarContent" class="question-list-container" style="margin-top: 16px;">
                                <!-- Question list will be populated here -->
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="screen" style="display: none;">
            <div class="score-card">
                <h2 class="score-percentage" id="scorePercentage">0%</h2>
                <p class="score-details" id="scoreDetails">0 out of 0 questions correct</p>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Quiz Complete!</h3>
                    <p class="card-subtitle">Review your performance</p>
                </div>
                <div class="card-content">
                    <button class="btn" id="retryBtn">Take Quiz Again</button>
                    <button class="btn" id="generate-report-btn" style="background-color: #34c759; margin-top: 10px;">📊 Generate Study Report</button>
                    <button class="btn btn-secondary" id="homeBtn">Back to Quizzes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating PDF Export Button -->
    <button id="floating-pdf-btn" class="floating-pdf-btn" title="Generate Study Report">
        📊 Report
    </button>
    
    <!-- Medical Tools Toggle Button -->
    <button id="medical-tools-toggle" class="medical-tools-toggle" title="Open Medical Tools">
        🩺
    </button>
    
    <!-- Medical Tools Panel -->
    <div id="medical-tools-panel" class="medical-tools-panel">
        <div class="tools-header">
            <h3>🩺 Medical Tools</h3>
            <button id="tools-close-btn" class="tools-close-btn">×</button>
        </div>
        
        <div class="tools-navigation">
            <button class="tool-nav-btn active" data-tool="drug-reference">💊 Drug Reference</button>
            <button class="tool-nav-btn" data-tool="calculators">🧮 Calculators</button>
            <button class="tool-nav-btn" data-tool="emergency-protocols">🚨 Emergency</button>
            <button class="tool-nav-btn" data-tool="interpretation">📋 Interpretation</button>
            <button class="tool-nav-btn" data-tool="lab-values">📊 Lab Values</button>
            <button class="tool-nav-btn" data-tool="guidelines">📋 Guidelines</button>
            <button class="tool-nav-btn" data-tool="differential-dx">🔍 Differential Dx</button>
            <button class="tool-nav-btn" data-tool="triads">🔺 Clinical Triads</button>
            <button class="tool-nav-btn" data-tool="examination">🩺 Examination</button>
        </div>
        
        <div class="tools-content">
            <!-- Drug Reference Panel -->
            <div id="drug-panel" class="tool-panel active">
                <div id="drug-reference-container">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">📊 Loading drug reference...</div>
                </div>
            </div>
            
            <!-- Calculator Panel -->
            <div id="calculator-panel" class="tool-panel">
                <div class="calculator-grid">
                    <button class="calculator-btn" data-calc="bmi">
                        <div class="calc-icon">⚖️</div>
                        <div class="calc-name">BMI Calculator</div>
                    </button>
                    <button class="calculator-btn" data-calc="chads2vasc">
                        <div class="calc-icon">💗</div>
                        <div class="calc-name">CHA2DS2-VASc</div>
                    </button>
                    <button class="calculator-btn" data-calc="hasbled">
                        <div class="calc-icon">🩸</div>
                        <div class="calc-name">HAS-BLED</div>
                    </button>
                    <button class="calculator-btn" data-calc="gcs">
                        <div class="calc-icon">🧠</div>
                        <div class="calc-name">Glasgow Coma</div>
                    </button>
                    <button class="calculator-btn" data-calc="apache">
                        <div class="calc-icon">🏥</div>
                        <div class="calc-name">APACHE II</div>
                    </button>
                    <button class="calculator-btn" data-calc="wells">
                        <div class="calc-icon">🫁</div>
                        <div class="calc-name">Wells PE Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="qrisk">
                        <div class="calc-icon">📊</div>
                        <div class="calc-name">QRISK3</div>
                    </button>
                    <button class="calculator-btn" data-calc="madders">
                        <div class="calc-icon">🧮</div>
                        <div class="calc-name">MADDERS</div>
                    </button>
                    <button class="calculator-btn" data-calc="mews">
                        <div class="calc-icon">⚡</div>
                        <div class="calc-name">MEWS</div>
                    </button>
                    <button class="calculator-btn" data-calc="crb65">
                        <div class="calc-icon">🦠</div>
                        <div class="calc-name">CRB-65</div>
                    </button>
                    <button class="calculator-btn" data-calc="rockall">
                        <div class="calc-icon">🩸</div>
                        <div class="calc-name">Rockall Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="child-pugh">
                        <div class="calc-icon">🫀</div>
                        <div class="calc-name">Child-Pugh</div>
                    </button>
                    <button class="calculator-btn" data-calc="ottawa-ankle">
                        <div class="calc-icon">🦴</div>
                        <div class="calc-name">Ottawa Ankle</div>
                    </button>
                    <button class="calculator-btn" data-calc="egfr">
                        <div class="calc-icon">🫘</div>
                        <div class="calc-name">eGFR Calculator</div>
                    </button>
                    <button class="calculator-btn" data-calc="urea-creatinine">
                        <div class="calc-icon">🧪</div>
                        <div class="calc-name">Urea:Creatinine Ratio</div>
                    </button>
                    <button class="calculator-btn" data-calc="abcd2">
                        <div class="calc-icon">🧠</div>
                        <div class="calc-name">ABCD² Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="must">
                        <div class="calc-icon">🍽️</div>
                        <div class="calc-name">MUST Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="waterlow">
                        <div class="calc-icon">🛏️</div>
                        <div class="calc-name">Waterlow Score</div>
                    </button>
                    <!-- NEW CALCULATORS FROM APP2.JS -->
                    <button class="calculator-btn" data-calc="grace">
                        <div class="calc-icon">💗</div>
                        <div class="calc-name">GRACE Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="crusade">
                        <div class="calc-icon">🩸</div>
                        <div class="calc-name">CRUSADE Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="phq9">
                        <div class="calc-icon">🧠</div>
                        <div class="calc-name">PHQ-9 Depression</div>
                    </button>
                    <button class="calculator-btn" data-calc="gad7">
                        <div class="calc-icon">😰</div>
                        <div class="calc-name">GAD-7 Anxiety</div>
                    </button>
                    <button class="calculator-btn" data-calc="insulin-sliding">
                        <div class="calc-icon">💉</div>
                        <div class="calc-name">Insulin Sliding</div>
                    </button>
                    <button class="calculator-btn" data-calc="vasopressor">
                        <div class="calc-icon">💊</div>
                        <div class="calc-name">Vasopressor Dosing</div>
                    </button>
                    <button class="calculator-btn" data-calc="frax">
                        <div class="calc-icon">🦴</div>
                        <div class="calc-name">FRAX Calculator</div>
                    </button>
                    <button class="calculator-btn" data-calc="news2">
                        <div class="calc-icon">⚡</div>
                        <div class="calc-name">NEWS2</div>
                    </button>
                    <button class="calculator-btn" data-calc="curb65">
                        <div class="calc-icon">🦠</div>
                        <div class="calc-name">CURB-65</div>
                    </button>
                    <button class="calculator-btn" data-calc="palliative">
                        <div class="calc-icon">🌸</div>
                        <div class="calc-name">Palliative Care</div>
                    </button>
                    <button class="calculator-btn" data-calc="grace">
                        <div class="calc-icon">💔</div>
                        <div class="calc-name">GRACE Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="crusade">
                        <div class="calc-icon">🩸</div>
                        <div class="calc-name">CRUSADE Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="timi">
                        <div class="calc-icon">❤️</div>
                        <div class="calc-name">TIMI Score</div>
                    </button>
                    <button class="calculator-btn" data-calc="nihss">
                        <div class="calc-icon">🧠</div>
                        <div class="calc-name">NIH Stroke Scale</div>
                    </button>
                    <button class="calculator-btn" data-calc="rankin">
                        <div class="calc-icon">🚶</div>
                        <div class="calc-name">Modified Rankin</div>
                    </button>
                    <button class="calculator-btn" data-calc="phq9">
                        <div class="calc-icon">😔</div>
                        <div class="calc-name">PHQ-9</div>
                    </button>
                    <button class="calculator-btn" data-calc="gad7">
                        <div class="calc-icon">😰</div>
                        <div class="calc-name">GAD-7</div>
                    </button>
                    <button class="calculator-btn" data-calc="insulin-sliding">
                        <div class="calc-icon">💉</div>
                        <div class="calc-name">Insulin Sliding Scale</div>
                    </button>
                    <button class="calculator-btn" data-calc="vasopressor">
                        <div class="calc-icon">💊</div>
                        <div class="calc-name">Vasopressor Dosing</div>
                    </button>
                    <button class="calculator-btn" data-calc="paediatric-dosing">
                        <div class="calc-icon">👶</div>
                        <div class="calc-name">Paediatric Dosing</div>
                    </button>
                    <button class="calculator-btn" data-calc="infusion-rate">
                        <div class="calc-icon">💧</div>
                        <div class="calc-name">Infusion Rate</div>
                    </button>
                    <button class="calculator-btn" data-calc="cockcroft-gault">
                        <div class="calc-icon">🫘</div>
                        <div class="calc-name">Cockcroft-Gault</div>
                    </button>
                    <button class="calculator-btn" data-calc="bsa">
                        <div class="calc-icon">📐</div>
                        <div class="calc-name">Body Surface Area</div>
                    </button>
                    <button class="calculator-btn" data-calc="fluid-balance">
                        <div class="calc-icon">🌊</div>
                        <div class="calc-name">Fluid Balance</div>
                    </button>
                </div>
                <div id="calculator-workspace" class="calculator-workspace">
                    <!-- Dynamic calculator content loads here -->
                </div>
            </div>
            
            <!-- Calculator Detail Panel -->
            <div id="calculator-detail" class="tool-panel">
                <div id="calculator-detail-container">
                    <!-- Individual calculator content loads here -->
                </div>
            </div>
            
            <!-- Lab Values Panel -->
            <div id="lab-panel" class="tool-panel">
                <div id="lab-values-container">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">📊 Loading lab values...</div>
                </div>
            </div>
            
            <!-- Guidelines Panel -->
            <div id="guidelines-panel" class="tool-panel">
                <!-- Content loaded dynamically by JavaScript -->
                <div class="loading-message">📋 Loading guidelines...</div>
            </div>
            
            <!-- Differential Diagnosis Panel -->
            <div id="differential-panel" class="tool-panel">
                <div id="differential-dx-container">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">🔍 Loading differential diagnosis...</div>
                </div>
            </div>
            
            <!-- Clinical Triads Panel -->
            <div id="triads-panel" class="tool-panel">
                <div class="search-container">
                    <input type="text" id="triads-search" placeholder="Search triads..." class="tool-search">
                    <button id="triads-search-btn">🔍</button>
                </div>
                <div class="triad-categories">
                    <button class="category-btn" data-category="all">All</button>
                    <button class="category-btn" data-category="cardiovascular">Cardiovascular</button>
                    <button class="category-btn" data-category="respiratory">Respiratory</button>
                    <button class="category-btn" data-category="neurologic">Neurologic</button>
                    <button class="category-btn" data-category="emergency">Emergency</button>
                    <button class="category-btn" data-category="infectious">Infectious</button>
                </div>
                <div id="triads-results" class="tool-results">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">🔍 Loading clinical triads...</div>
                </div>
            </div>

            <!-- Clinical Examination Panel -->
            <div id="examination-panel" class="tool-panel">
                <div id="examination-container">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">🩺 Loading examination guide...</div>
                </div>
            </div>

            <!-- Emergency Protocols Panel -->
            <div id="emergency-protocols-panel" class="tool-panel">
                <div class="emergency-categories">
                    <button class="category-btn active" data-category="all">All Protocols</button>
                    <button class="category-btn" data-category="cardiac">Cardiac</button>
                    <button class="category-btn" data-category="respiratory">Respiratory</button>
                    <button class="category-btn" data-category="trauma">Trauma</button>
                    <button class="category-btn" data-category="sepsis">Sepsis</button>
                    <button class="category-btn" data-category="metabolic">Metabolic</button>
                </div>
                <div id="emergency-protocols-container" class="tool-results">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">🚨 Loading emergency protocols...</div>
                </div>
            </div>

            <!-- Interpretation Tools Panel -->
            <div id="interpretation-panel" class="tool-panel">
                <div class="interpretation-categories">
                    <button class="category-btn active" data-category="all">All Tools</button>
                    <button class="category-btn" data-category="ecg">ECG</button>
                    <button class="category-btn" data-category="abg">ABG</button>
                    <button class="category-btn" data-category="imaging">Imaging</button>
                    <button class="category-btn" data-category="lab">Lab Results</button>
                </div>
                <div id="interpretation-container" class="tool-results">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="loading-message">📋 Loading interpretation tools...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript will be loaded here -->
    <script src="/static/js/drugDatabase.js"></script>
    <script src="/static/js/app.js"></script>
    
    <script>
        // Add event listener for report generation
        document.addEventListener('DOMContentLoaded', () => {
            // Add report generation handler for both buttons
            document.addEventListener('click', (e) => {
                if (e.target.id === 'generate-report-btn' || e.target.id === 'floating-pdf-btn') {
                    if (window.quizApp) {
                        window.quizApp.generateStudyReport();
                    }
                }
            });
            
            // Show/hide floating button based on quiz state
            const updateFloatingButton = () => {
                const floatingBtn = document.getElementById('floating-pdf-btn');
                const quizSelectionScreen = document.getElementById('quizSelection');
                
                if (floatingBtn && quizSelectionScreen) {
                    // Hide on quiz selection screen, show everywhere else
                    const isQuizSelection = quizSelectionScreen.style.display !== 'none';
                    floatingBtn.style.display = isQuizSelection ? 'none' : 'flex';
                }
            };
            
            // Check periodically for screen changes
            setInterval(updateFloatingButton, 500);
            updateFloatingButton(); // Initial check
            
            // Initialize quiz length selection
            setTimeout(() => {
                if (window.quizApp) {
                    window.quizApp.updateQuizLengthInfo();
                }
            }, 100);
        });
    </script>
</body>
</html>